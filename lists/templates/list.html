{% extends "base.html" %}
{% block title %}{{ list }}{% endblock %}
{% block header %}
<style>
	#items {margin-top:10px;}
	input {height:30px;}
</style>
<script>
$(document).ready(function() {
	$('#add_item').on('click', addItem);

	$('#clear_list').on('click', clearList);

	$('body').on('change', 'input[type=checkbox]', updateStatus);

	$newItem = $('#new_item');

	runOnEnter($newItem, addItem);

	$newItem.focus();

	$('#items').sortable({
		stop: updateOrder
	});
});

function updateOrder(event, ui){

}
function addItem(){
	var newItem = $('#new_item').val();
	$.ajax('add/' + newItem, {
		success: function(data){
			item = JSON.parse(data);
			$('#items').append('<label class="checkbox"><input type="checkbox" name="complete" id="' + item.pk + '">' + item.name + '</label>');
			$('#new_item').val('');
			$('#new_item').focus();
		}
	});
}

function clearList(){
	$.ajax('clear/');
	$('#items').empty();
	$('#new_item').focus();
}

function updateStatus(){
	var $item = $(this);
	if ($item.is(':checked')){
		$item.parent().addClass('complete').delay(500).fadeOut();
		$.ajax('remove/' + this.id)
	}
	else {
		$item.parent().removeClass('complete');
	}

	$('#new_item').focus();
}
</script>
{% endblock %}
{% block content %}
	<h1>{{ list }} (by <a href="/{{ list.user.username }}/">{{ list.user }}</a>)</h1>
		<div class="row-fluid">
			<div class="form-inline">
				<input type="text" placeholder="new item" id="new_item" name="new_item" class="input-large">
				<input type="button" id="add_item" value="add" class="btn btn-success">
				<input type="button" id="clear_list" value="clear list" class="btn btn-warning">
			</div>
		</div>
		<div class="row-fluid">
			<div class="row8">
				<div class="controls" id="items">
				{% for item in list.item_set.all %}
					<label class="checkbox">
						<input type="checkbox" {% if item.complete %} checked="checked" class="complete" {% endif %} name="complete" id="{{ item.pk }}">
						{{ item }}
					</label>
				{% endfor %}
				</div>
			</div>
		</div>
{% endblock %}