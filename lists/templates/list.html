{% extends "base.html" %}
{% block title %}{{ list }}{% endblock %}
{% block header %}
<style>
	#items { list-style-type: none; margin: 0; padding: 0; width: 60%; }
	#items li { margin: 0 3px 3px 3px; padding: 0.4em; padding-left: 1.5em; font-size: 1.4em; height: 18px; }
	#items li span { position: absolute; margin-left: -1.3em; }
</style>
<script>
$(document).ready(function() {
	$('#add_item').on('click', addItem);

	$('#clear_list').on('click', clearList);

	$('body').on('change', 'input[type=checkbox]', updateStatus);

	$newItem = $('#new_item');

	runOnEnter($newItem, addItem);

	$newItem.focus();

	$('#items').sortable({
		stop: updateOrder
	});
});

function updateOrder(event, ui){

}
function addItem(){
	var newItem = $('#new_item').val();
	$.ajax('add/' + newItem, {
		success: function(data){
			item = JSON.parse(data);
			$('#items').append('<li><input type="checkbox" name="complete" id="' + item.pk + '"> <label for="' + item.pk + '">' + item.name + '</label></li>');
			$('#new_item').val('');
			$('#new_item').focus();
		}
	});
}

function clearList(){
	$.ajax('clear/');
	$('#items').empty();
	$('#new_item').focus();
}

function updateStatus(){
	var $item = $(this);
	if ($item.is(':checked')){
		$item.parent().addClass('complete').delay(500).fadeOut();
		$.ajax('remove/' + this.id)
	}
	else {
		$item.parent().removeClass('complete');
	}

	$('#new_item').focus();
}
</script>
{% endblock %}
{% block content %}
	<h1>{{ list }} (by <a href="/{{ list.user.username }}/">{{ list.user }}</a>)</h1>
	<div><input type="text" placeholder="new item" id="new_item" name="new_item"><input type="button" id="add_item" value="add"> <input type="button" id="clear_list" value="clear list"></div>
	<ul id="items">
	{% for item in list.item_set.all %}
		<li><input type="checkbox" {% if item.complete %} checked="checked" class="complete" {% endif %} name="complete" id="{{ item.pk }}">
		<label for="{{ item.pk }}">{{ item }}</label></li>
	{% endfor %}
	</ul>
{% endblock %}