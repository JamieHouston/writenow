{% extends "base.html" %}
{% block title %}{{ list }}{% endblock %}
{% block header %}
<script>
$(document).ready(function() {
	$('#add_item').on('click', addItem);

	$('#clear_list').on('click', clearList);

	$('body').on('change', 'input[type=checkbox]', removeItem);

	$('#new_item').on('keyup', checkForNewItem).focus();
});

function checkForNewItem(e){
	if (e.keyCode == 13) addItem();
}

function addItem(){
	var newItem = $('#new_item').val();
	$.ajax('add/' + newItem, {
		success: function(data){
			item = JSON.parse(data);
			$('#items').append('<li><input type="checkbox" name="complete" id="' + item.pk + '"> <label for="' + item.pk + '">' + item.name + '</label></li>');
			$('#new_item').val('');
			$('#new_item').focus();
		}
	});
}

function clearList(){
	$.ajax('clear/');
	$('#items').empty();
	$('#new_item').focus();
}

function removeItem(){
	var $item = $(this);
	$.ajax('remove/' + this.id);
	$item.parent().fadeOut();
	$('#new_item').focus();

}
</script>
{% endblock %}
{% block content %}
	<h1>{{ list }} (by <a href="/l/{{ list.user.username }}/">{{ list.user }}</a>)</h1>
	<div><input type="text" placeholder="new item" id="new_item" name="new_item"><input type="button" id="add_item" value="add"> <input type="button" id="clear_list" value="clear list"></div>
	<ul id="items">
	{% for item in list.item_set.all %}
		<li><input type="checkbox" {% if item.complete %} checked="checked" {% endif %} name="complete" id="{{ item.pk }}">
		<label for="{{ item.pk }}">{{ item }}</label></li>
	{% endfor %}
	</ul>
{% endblock %}